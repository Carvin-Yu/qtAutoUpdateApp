name: Update feature Branches

on:
  push:
    branches:
      - main

jobs:
  update-branches:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Fetch all branches
        run: git fetch --all

      - name: Merge changes to other branches
        run: |
          # 获取所有分支列表
          branches=$(git branch --list --format="%(refname:lstrip=2)")

          # 遍历分支列表
          for branch in $branches; do
            # 跳过main分支
            if [ "$branch" != "main" ]; then
              # 切换到分支
              git checkout "$branch"

              # 合并main分支的变更
              git merge main --no-commit

              # 提交合并结果
              git commit -m "Merge changes from main"

              # 推送到远程分支
              git push origin "$branch"
            fi
          done

          # 切换回main分支
          git checkout main

